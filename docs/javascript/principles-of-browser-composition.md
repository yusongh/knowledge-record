# 浏览器组成原理

## 目标问题

1. 浏览器有哪些主流内核？

2. 浏览器核心组成部分有哪些？

3. 浏览器是多进程应用程序还是单进程应用程序？有那些核心进程？

4. 那些操作会阻塞浏览器渲染？

5. 样式在head中引入和body中有什么区别？

6. 如何通过工具分析资源的加载，解析，渲染性能？

7. 资源加载是否有优先级？是怎么划分的？

## 浏览器核心组成

![浏览器组成](../.vuepress/public/images/javascript/principles-of-browser-composition/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BB%84%E6%88%90.png)

- 浏览器引擎主要扶着调度其他引擎，主要跟用户交互打交道
- 渲染引擎中有许多线程，例如 html 解析线程、css 解析线程、dom 树和 css 树合成线程等。合成的结果是矢量图，因此不会失真。CPU 将合成的结果交给 GPU 进行绘制

> 后面的整体架构中有更详细的组成

### 浏览器内核分类

浏览器内核指的是`渲染引擎`

- IE: Trident
- Firefox: Gecko
- Chrome: 以前是webkit，现在是Blink内核
- safari: webkit
- Opera: 以前是webkit，现在是Blink内核

> Blink 是从 webkit 拉的分支修改的

## 整体架构

![浏览器整体架构](../.vuepress/public/images/javascript/principles-of-browser-composition/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.png)

- html 解析器和 css 解析器是并行工作的。会存在三种情况
  - html 先解析完，需要等待 css 解析，最后合成 render 树
  - css 先解析完，等待 html 解析，最后合成 render 树
  - html 先解析完，先渲染到页面，等 css 解析完后再合成 render 树渲染。该情况下会出现页面闪动的情况
- v8 引擎与（html 解析器、css 解析器）是互斥关系。
- 布局器：将 html 解析器与 css 解析器的结果合成的渲染树，计算布局，包括元素的大小、位置
- 绘图器：拿到布局的相关信息进行绘制
- 插件层：是一个单向沙箱结构，它可以访问当前页面的内存空间（当前页面的全局上下文），但是当前页面不可以访问插件的内存数据（插件内部的上下文）。

- 网络模块：多线程，因此可以并行请求。chrome 最大并行量为 6 个请求
- 图形库：例如页面上有一个 div 标签，那么从图形库中就可以直到渲染成矩形。样式是图形库的一些参数，比如要显示圆角，或者绿色的 1 像素边框，然后图形库根据这些参数显示给出对应的图形
- 合成器：因为页面是有多个图层的，因此需要合成后显示。渲染引擎在分析时会将图层顺序关系计算出来，给到绘图器，绘图器调用合成器合成

## 工作原理


